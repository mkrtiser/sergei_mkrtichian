<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0b0b0b">
<meta name="apple-mobile-web-app-title" content="Sergei Mkrtichian">
<meta name="application-name" content="Sergei Mkrtichian">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<title>Sergei Mkrtichian — Official Website</title>
<style>
  :root{
    --black: #000000;
    --frame: #1B1A16;
    --dark-gray: #0b0b0b;
    --light-cream: #fbf8f4;
    --muted: #7a7a7a;
    --accent: #B8860B;
    --accent-light: #DAA520;
    --hero-fp-x: 33.3%;
    --hero-fp-y: 37.8%;

    /* Header scale — будет менять JS только при необходимости */
    --hs: 1;
  }

  html { height: -webkit-fill-available; }
  html,body{
    height:100%;margin:0;padding:0;
    background:var(--black);
    font-family:"Georgia",serif;color:#fff;
    scroll-behavior:smooth;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: none;
  }

  .hero { height: 100vh; height: -webkit-fill-available; height: 100dvh; }

  * { -webkit-text-size-adjust: 100%; }
  a{color:inherit; text-decoration: none;}
  button{font-family:inherit; cursor: pointer;}

  .text-reveal { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease, transform 0.8s ease; will-change: opacity, transform; }
  .text-reveal.visible { opacity: 1; transform: translateY(0); }

  /* ====== HEADER - exact behavior preserved, but sizes multiplied by --hs ====== */
  header{
    position:fixed;top:0;left:0;width:100%;
    height: calc((80px * var(--hs)) + env(safe-area-inset-top));
    background:rgba(0,0,0,0);color:#fff;
    display:flex;align-items:center;justify-content:space-between;
    padding:0 calc(28px * var(--hs));z-index:1100;box-sizing:border-box;
    transition:transform .25s ease,opacity .25s ease,background .25s ease, height .18s ease, padding .18s ease;
    padding-top: env(safe-area-inset-top);
    flex-wrap: nowrap;
    gap: calc(18px * var(--hs));
    min-width: 0;
  }
  header img.logo{
    height: calc(56px * var(--hs));
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.36s ease, transform 0.36s ease, height .18s ease;
    max-width: 40%;
    width: auto;
    flex: 0 0 auto;
    margin: 0;
    box-sizing: border-box;
    object-fit: contain;
  }
  header img.logo.visible{ opacity: 1; transform: translateY(0); }

  nav{
    display:flex;
    gap: calc(18px * var(--hs));
    font-size: calc(16px * var(--hs));
    align-items:center;
    flex: 1 1 auto;
    justify-content:flex-end;
    min-width: 0;
    white-space: nowrap;
    overflow: visible; /* no ellipsis — we scale instead */
  }
  nav a{
    color:#fff;text-decoration:none;font-weight:500;
    opacity: 0; transform: translateY(-20px);
    transition: opacity 1s ease .1s, transform 1s ease .1s, color .25s;
    white-space: nowrap; overflow: visible; text-overflow: clip;
    flex: 0 1 auto; min-width: 0;
    padding: calc(6px * var(--hs)) calc(8px * var(--hs));
    box-sizing: border-box;
    font-size: inherit;
  }
  nav a.visible{ opacity: 1; transform: translateY(0); }
  nav a:hover{ opacity: .85; }

  /* Rest of CSS unchanged (kept from your original) */
  .hero{ display:block; background:var(--black); overflow:hidden; position:relative; }
  .hero-frame{ width:100%;height:100%;position:relative;overflow:hidden;background:#000 }
  .hero-frame img{ width:100%; height:100%; object-fit:cover; object-position: var(--hero-fp-x) var(--hero-fp-y); transform-origin:center center; transition:transform 1.6s ease,opacity 1.2s ease; display:block; opacity: 0; }
  .hero-frame img.loaded{ opacity: 1; }

  .text-block{ background:var(--light-cream);color:#05053b;padding:120px 20px 60px;text-align:center; position: relative; }
  .text-block:before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
  .text-block h1{ font-size:42px;font-weight:400;margin:0 0 14px; }
  .text-block p{ font-size:18px;color:var(--muted);max-width:900px; margin:0 auto 16px;line-height:1.6; }
  .text-block em{ display:block;margin-top:14px;font-style:normal;color:#444;font-size:17px }

  .socials{ display:flex;flex-direction:column;align-items:center;gap:16px;margin-top:46px }
  .socials a{ display:flex;align-items:center;justify-content:center;gap:12px; text-decoration:none;font-weight:500;font-size:18px;color:#fff; border-radius:50px;padding:14px 48px;width:260px;text-align:center; transition:transform .25s ease,opacity .25s; opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease, background .25s; }
  .socials a.visible{ opacity: 1; transform: translateY(0); }
  .socials a svg{width:22px;height:22px;fill:currentColor}
  .socials a.instagram{background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af,#515bd4)}
  .socials a.facebook{background:#1877f2}
  .socials a.youtube{background:#ff0000}
  .socials a.email{background:linear-gradient(45deg,var(--accent),var(--accent-light))}
  .socials a:hover{transform:scale(1.04);opacity:.95}

  .bio-photos{ margin-top:34px;display:flex;flex-wrap:wrap;gap:14px;justify-content:center }
  .bio-photos button{ background:transparent;border:0;padding:0;cursor:pointer; border-radius:10px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.6); transition:transform .25s ease,opacity .25s; opacity: 0; transform: translateY(20px); }
  .bio-photos button.visible{ opacity: 1; transform: translateY(0); }
  .bio-photos button img{ display:block;width:180px;height:120px;object-fit:cover;background:var(--black) }
  .bio-photos button:hover{transform:scale(1.03);opacity:.95}

  #cv{ background:var(--dark-gray); padding:90px 20px 120px; color:#fff; text-align:center; position: relative; }
  #cv:before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
  #cv h2{ font-size:38px; font-weight:400; margin-bottom:12px; opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease; }
  #cv h2.visible{ opacity: 1; transform: translateY(0); }
  #cv p.lead{ max-width:900px; margin:0 auto 20px; color:#ccc; font-size:18px; line-height:1.6; opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease 0.1s, transform 0.8s ease 0.1s; }
  #cv p.lead.visible{ opacity: 1; transform: translateY(0); }
  .cv-actions{ display:flex; gap:16px; justify-content:center; margin:30px 0 50px; flex-wrap: wrap; }
  .cv-actions a.btn{ display:inline-flex; align-items:center; gap:10px; text-decoration:none; color:#fff; border-radius:50px; padding:14px 36px; font-weight:500; font-size:16px; transition: all 0.3s ease; opacity: 0; transform: translateY(15px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
  .cv-actions a.btn.visible{ opacity: 1; transform: translateY(0); }
  .cv-actions a.btn.download{ background:var(--dark-gray); border:1px solid rgba(255,255,255,0.1); }
  .cv-actions a.btn.view{ background:linear-gradient(45deg,var(--accent),var(--accent-light)); }
  .cv-actions a.btn:hover{ transform:translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
  .cv-actions a.btn svg{width:20px;height:20px;fill:currentColor}

  .cv-details{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:40px; max-width:1100px; margin:0 auto; text-align:left }
  .cv-block{ opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease; padding: 30px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
  .cv-block.visible{ opacity: 1; transform: translateY(0); }
  .cv-block h3{ color:#fff; margin-top:0; margin-bottom:15px; font-size:20px; font-weight:600; display: flex; align-items: center; gap: 10px; }
  .cv-block h3:before { content: ''; width: 4px; height: 20px; background: var(--accent); border-radius: 2px; }
  .cv-block ul{ margin:0; padding-left:20px; color:#cfcfcf; line-height:1.8; font-size: 16px; }
  .cv-block ul li { margin-bottom: 8px; position: relative; }

  #performances{ background:var(--black);padding:100px 20px 140px;text-align:center; position: relative; }
  #performances:before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
  #performances h2{ color:#fff;font-size:42px;font-weight:400;margin-bottom:60px; opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease; }
  #performances h2.visible{ opacity: 1; transform: translateY(0); }
  .video-grid{ display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:28px;justify-items:center;width:100%;max-width:1200px;margin:0 auto }
  .video-wrapper { position: relative;width: 100%;padding-bottom: 56.25%;overflow: hidden;border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.6); background: #000; border: 1px solid rgba(255,255,255,0.03); opacity: 0; transform: translateY(30px); transition: opacity 1s ease, transform 1s ease; }
  .video-wrapper.visible { opacity: 1; transform: translateY(0); }
  .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; opacity: 0; transition: opacity 0.3s ease 0.1s; }
  .video-wrapper.visible iframe { opacity: 1; }

  #contacts{ background:var(--light-cream); color:#05053b; padding:80px 20px; text-align:center; position: relative; }
  #contacts:before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
  #contacts h2{ font-size:30px; margin-bottom:12px; opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease; }
  #contacts h2.visible{ opacity: 1; transform: translateY(0); }
  .contact-inner{ max-width:800px; margin:0 auto }
  .contact-inner p{ color:#333; margin-bottom:18px; opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease 0.1s, transform 0.8s ease 0.1s; }
  .contact-inner p.visible{ opacity: 1; transform: translateY(0); }
  .contact-actions{ display:flex; gap:16px; justify-content:center; flex-wrap:wrap }
  .contact-actions a.email-btn{ display:inline-flex; align-items:center; justify-content:center; gap:10px; text-decoration:none; color:#fff; border-radius:50px; padding:14px 36px; font-weight:500; background:linear-gradient(45deg,var(--accent),var(--accent-light)); transition: all 0.3s ease; opacity: 0; transform: translateY(15px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
  .contact-actions a.email-btn.visible{ opacity: 1; transform: translateY(0); }
  .contact-actions a.email-btn:hover{ transform:translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
  .contact-actions a.email-btn svg{ width:20px; height:20px; fill:currentColor }

  footer { background:var(--frame); color:#ccc; text-align:center; font-size:15px; padding:40px 20px; border-top:1px solid rgba(255,255,255,0.05); position: relative; padding-bottom: calc(40px + env(safe-area-inset-bottom)); }
  footer:before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
  footer a { color: var(--accent); transition: color 0.3s ease; }
  footer a:hover { color: var(--accent-light); }

  #loader { position:fixed;top:0;left:0;width:100%;height:100%; background:var(--frame); display:flex;align-items:center;justify-content:center;z-index:9999; transition:opacity 0.8s ease; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); height: calc(100% + env(safe-area-inset-top) + env(safe-area-inset-bottom)); }
  #loader.hidden { opacity:0; pointer-events:none; }
  .loader-content { display:flex; flex-direction:column; align-items:center; gap:20px; }
  .loader-logo { width:120px; height:auto; background:var(--frame); display:block; object-fit:contain; filter:none; }
  .spinner { width:50px; height:50px; border:6px solid rgba(201, 163, 74, 0.15); border-top-color:var(--accent); border-radius:50%; animation: spin 1s linear infinite; }
  @keyframes spin {to{transform:rotate(360deg)}}

  .modal-backdrop{ position:fixed;inset:0;background:rgba(0,0,0,0.85); display:none;align-items:center;justify-content:center;z-index:2000;padding:20px }
  .modal-backdrop.visible{display:flex}
  .modal-content{ max-width:1200px;max-height:90vh;overflow:auto; border-radius:8px;position:relative }
  .modal-content img{ display:block;max-width:100%;height:auto;border-radius:6px }
  .modal-close{ position:absolute;top:10px;right:10px;background:rgba(0,0,0,.5); border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:16px }
  .modal-caption{ color:#ddd;margin-top:8px;text-align:center }
  .pdf-frame{ width:95vw;height:85vh;border:0;border-radius:6px;background:#fff }
</style>
</head>
<body>

<div id="loader">
  <div class="loader-content">
    <img src="logo.jpg" alt="Logo" class="loader-logo">
    <div class="spinner" aria-hidden="true"></div>
  </div>
</div>

<header id="header">
  <img src="logo.jpg" alt="Логотип" class="logo">
  <nav>
    <a href="#performances">Performances</a>
    <a href="#cv">CV</a>
    <a href="#text-block">About</a>
    <a href="#contacts">Contacts</a>
  </nav>
</header>

<div class="hero" id="hero">
  <div class="hero-frame" aria-hidden="false">
    <img id="heroImg" src="s.JPG" alt="Sergei Mkrtichian — portrait">
  </div>
</div>

<div class="text-block" id="text-block">
  <h1 class="text-reveal">Dear Friends,</h1>
  <p class="text-reveal">I've created this site so you can find out more about me, what I've done in the past, and what I'm up to currently. I look forward to connecting with you at my concerts.</p>
  <em class="text-reveal">- Sergei Mkrtichian</em>

  <div class="socials" aria-hidden="false">
    <a class="instagram text-reveal" href="https://www.instagram.com/sergunchik_mk/" target="_blank" rel="noopener">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2Zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5A4.25 4.25 0 0 0 20.5 16.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5Zm8.75 2.25a.75.75 0 1 1 0 1.5h-.01a.75.75 0 1 1 0-1.5h.01ZM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Z"/></svg>
      Instagram
    </a>

    <a class="facebook text-reveal" href="https://www.facebook.com/profile.php?id=100095484424565" target="_blank" rel="noopener">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8v-3h2.5V9.5c0-2.4 1.4-3.8 3.6-3.8 1 0 2 .2 2 .2v2.2H15c-1.2 0-1.6.8-1.6 1.5V12H17l-.5 3h-3v7A10 10 0 0 0 22 12Z"/></svg>
      Facebook
    </a>

    <a class="youtube text-reveal" href="https://youtube.com/@sergei_mkrtichian?si=yijFIbmlZmJFL3BU" target="_blank" rel="noopener">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.8 8s-.2-1.4-.8-2c-.8-.8-1.7-.8-2.2-.9C16.2 4.9 12 4.9 12 4.9h-.1s-4.2 0-6.8.2c-.5 0-1.5.1-2.2.9-.6.6-.8 2-.8 2S2 9.6 2 11.2v1.6c0 1.6.2 3.2.2 3.2s.2 1.4.8 2c.8.8 1.8.8 2.3.9 1.7.2 7 .2 7 .2s4.2 0 6.8-.2c.5 0 1.5-.1 2.2-.9.6-.6.8-2 .8-2s.2-1.6.2-3.2v-1.6c0-1.6-.2-3.2-.2-3.2ZM10 14.7V9.3l5.2 2.7L10 14.7Z"/></svg>
      YouTube
    </a>
  </div>
</div>

<section id="cv" aria-labelledby="cv-heading">
  <h2 id="cv-heading" class="text-reveal">Curriculum Vitae</h2>
  <p class="lead text-reveal">Sergei Mkrtichian — concert violinist. Educated at leading conservatories, prize-winner of international competitions, performer in major halls across Europe and beyond.</p>

  <div class="cv-actions">
    <a class="btn download text-reveal" href="Sergei_Mkrtichian_CV.pdf" target="_blank" rel="noopener">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v10m0 0 4-4m-4 4-4-4M4 21h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
      Download CV (PDF)
    </a>
  </div>

  <div class="cv-details">
    <div class="cv-block text-reveal">
      <h3>Education</h3>
      <ul>
        <li>Conservatory of the Italian Switzerland 2024 - Present Time.</li>
        <li>Academic Music College of Moscow State Conservatory named after P.I. Tchaikovsky 2015 - Present time.</li>
      </ul>
    </div>

    <div class="cv-block text-reveal">
      <h3>Competitions & Awards</h3>
      <ul>
        <li>2024 – Second prize at the 20th Khachaturian International Competition</li>
        <li>2023 – Third Prize at the Tchaikovsky Youth International Competition.</li>
      </ul>
    </div>

    <div class="cv-block text-reveal">
      <h3>Concert Highlights</h3>
      <ul>
        <li>Moscow State Kremlin Palace</li>
        <li>Wiener Konzerthaus</li>
        <li>Moscow Bolshoy Theatre</li>
      </ul>
    </div>
  </div>
</section>

<section id="performances">
  <h2 class="text-reveal">Recent Performances</h2>
  <div class="video-grid">
    <div class="video-wrapper text-reveal"><iframe src="https://www.youtube.com/embed/nX7k7yeU0yM" allowfullscreen loading="lazy"></iframe></div>
    <div class="video-wrapper text-reveal"><iframe src="https://www.youtube.com/embed/sCxiMHqT4Gc" allowfullscreen loading="lazy"></iframe></div>
    <div class="video-wrapper text-reveal"><iframe src="https://www.youtube.com/embed/NjxJHLJn62E" allowfullscreen loading="lazy"></iframe></div>
    <div class="video-wrapper text-reveal"><iframe src="https://www.youtube.com/embed/_C4V_rPluoY" allowfullscreen loading="lazy"></iframe></div>
  </div>
</section>

<section id="contacts">
  <h2 class="text-reveal">Contact</h2>
  <div class="contact-inner">
    <p class="text-reveal">For concert bookings, masterclasses, and collaborations please contact:</p>
    <div class="contact-actions">
      <a class="email-btn text-reveal" href="mailto:mkrtiart1959@gmail.com" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Zm0 2v.01l8 5 8-5V6H4Zm16 12V8.24l-8 5-8-5V18h16Z"/></svg>
        mkrtiart1959@gmail.com
      </a>
    </div>
  </div>
</section>

<footer>
  © 2025 Sergei Mkrtichian. This website is licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener">Apache License 2.0</a>.
</footer>

<div id="modal" class="modal-backdrop" role="dialog" aria-hidden="true">
  <div class="modal-content" role="document">
    <button class="modal-close" id="modalClose">✕</button>
    <div id="modalInner" style="text-align:center;"></div>
    <div class="modal-caption" id="modalCaption"></div>
  </div>
</div>

<script>
/* Existing behavior (loader/hero) preserved */
const hero = document.getElementById('hero');
const heroImg = document.getElementById('heroImg');
const header = document.getElementById('header');
const loader = document.getElementById('loader');
const maxScale = 1.2;
let currentScale = 1;

function initHeroImage() {
  if (heroImg.complete) {
    heroImg.classList.add('loaded');
  } else {
    heroImg.onload = () => {
      heroImg.classList.add('loaded');
      // logo size may change visually after hero loads; re-fit header
      fitHeaderScale();
    };
    heroImg.onerror = () => {
      console.error('Hero image failed to load');
      heroImg.classList.add('loaded');
      fitHeaderScale();
    };
  }
}
const isFirstVisit = !localStorage.getItem('visited');
if(isFirstVisit){ localStorage.setItem('visited', 'true'); loader.style.display = 'flex'; } else { loader.style.display = 'none'; }
initHeroImage();

window.addEventListener('load', () => {
  setTimeout(() => {
    loader.classList.add('hidden');
    setTimeout(() => {
      loader.style.display = 'none';
      const logo = document.querySelector('header img.logo');
      const navLinks = document.querySelectorAll('nav a');
      if (logo) logo.classList.add('visible');
      navLinks.forEach((link, index) => {
        setTimeout(() => { link.classList.add('visible'); }, index * 100);
      });
      initScrollAnimations();
      fitHeaderScale();
    }, 800);
  }, 500);
});

/* Parallax */
function animate() {
  const rect = hero.getBoundingClientRect();
  const windowHeight = window.innerHeight;
  const scrollY = window.scrollY;
  let progress = 0;
  if (rect.bottom > 0 && rect.top < windowHeight) {
    progress = (windowHeight - rect.top) / (windowHeight + rect.height);
    progress = Math.min(Math.max(progress, 0), 1);
  }
  const targetScale = 1 + progress * (maxScale - 1);
  currentScale += (targetScale - currentScale) * 0.1;
  heroImg.style.transform = `scale(${currentScale})`;
  const appearProgress = Math.min(scrollY / 300, 1);
  const bgOpacity = 0.35 * appearProgress;
  header.style.background = `rgba(0, 0, 0, ${bgOpacity})`;
  let hideProgress = 0;
  if (rect.top < 0) hideProgress = Math.min(Math.abs(rect.top) / 250, 1);
  const translateY = -100 * hideProgress;
  const finalOpacity = 1 - hideProgress;
  header.style.transform = `translateY(${translateY}%)`;
  header.style.opacity = finalOpacity;
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

/* Scroll reveal (unchanged) */
function initScrollAnimations() {
  const animatedElements = [
    ...document.querySelectorAll('.text-reveal'),
    ...document.querySelectorAll('.socials a'),
    ...document.querySelectorAll('.bio-photos button'),
    ...document.querySelectorAll('.cv-actions a.btn'),
    ...document.querySelectorAll('.cv-block'),
    ...document.querySelectorAll('.video-wrapper'),
    ...document.querySelectorAll('.contact-actions a.email-btn')
  ];
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const delay = entry.target.classList.contains('video-wrapper') ? 150 : 100;
        setTimeout(() => {
          entry.target.classList.add('visible');
          if (entry.target.classList.contains('video-wrapper')) {
            const iframe = entry.target.querySelector('iframe');
            if (iframe) {
              setTimeout(() => { iframe.style.opacity = '1'; }, 100);
            }
          }
        }, delay);
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
  animatedElements.forEach(el => { if (el) observer.observe(el); });
}

/* ============================
   Smart header scaling (updated)
   ============================
   - учитывает ширину каждого слова (boundingRect.width)
   - учитывает gap внутри nav и gap header между logo и nav
   - оставляет исходные размеры пока всё помещается
*/
function pxToNumber(px) {
  if (!px) return 0;
  return parseFloat(px.replace('px','')) || 0;
}

function getGapPx(el) {
  const cs = getComputedStyle(el);
  // modern: cs.gap; fallback to cs.columnGap/rowGap
  const gap = cs.gap || cs.columnGap || '0px';
  return pxToNumber(gap);
}

function fitHeaderScale() {
  const MIN_HS = 0.58; // минимальное значение
  const headerEl = document.getElementById('header');
  if (!headerEl) return;

  // Reset to native size first
  headerEl.style.setProperty('--hs', '1');

  // Force layout
  const headerClientWidth = headerEl.clientWidth;

  // Elements
  const logo = headerEl.querySelector('img.logo');
  const nav = headerEl.querySelector('nav');
  const anchors = nav ? Array.from(nav.querySelectorAll('a')) : [];

  // Calculate logo width (actual rendered)
  const logoWidth = logo ? Math.ceil(logo.getBoundingClientRect().width) : 0;

  // Calculate each anchor width (actual rendered)
  let anchorsSum = 0;
  anchors.forEach(a => {
    const r = a.getBoundingClientRect();
    anchorsSum += Math.ceil(r.width);
  });

  // Gaps
  const navGap = nav ? getGapPx(nav) : 0;            // gap between nav items
  const headerGap = getGapPx(headerEl);             // gap between logo and nav (header gap)

  // Total nav gaps width:
  const navGapsTotal = Math.max(0, anchors.length - 1) * navGap;

  // Total required content width at current scale=1
  let required = logoWidth + headerGap + anchorsSum + navGapsTotal;

  // If nav is empty, no headerGap required (header gap applies only if logo and nav both present)
  if (!logo || anchors.length === 0) {
    required = anchorsSum;
  }

  // Small epsilon tolerance
  const EPS = 1;

  if (required <= headerClientWidth + EPS) {
    // Fits — ensure --hs is exactly 1
    headerEl.style.setProperty('--hs', '1');
    return;
  }

  // Compute needed scale factor (how much to multiply sizes so that required * scale <= header width)
  // But note: when we multiply font-size and padding etc by scale, anchor widths and logo heights will scale roughly linearly.
  // So needed = available / required
  let needed = (headerClientWidth - EPS) / required;

  // Apply small safety multiplier to avoid jitter
  needed = needed * 0.995;

  if (needed < MIN_HS) needed = MIN_HS;

  // Apply scale
  headerEl.style.setProperty('--hs', String(needed));

  // Iterate a few times to stabilize (measure actual widths after scale application)
  for (let i = 0; i < 6; i++) {
    // Force reflow then re-measure
    const newLogoWidth = logo ? Math.ceil(logo.getBoundingClientRect().width) : 0;
    let newAnchorsSum = 0;
    anchors.forEach(a => newAnchorsSum += Math.ceil(a.getBoundingClientRect().width));
    const newNavGapsTotal = Math.max(0, anchors.length - 1) * getGapPx(nav);
    const newRequired = newLogoWidth + headerGap + newAnchorsSum + newNavGapsTotal;

    if (newRequired <= headerEl.clientWidth + EPS) {
      // good
      return;
    }

    // compute additional factor
    let factor = (headerEl.clientWidth - EPS) / newRequired;
    factor = factor * 0.995;
    let currentHs = parseFloat(getComputedStyle(headerEl).getPropertyValue('--hs')) || needed;
    let nextHs = currentHs * factor;
    if (nextHs < MIN_HS) nextHs = MIN_HS;
    // if change is negligible, stop
    if (Math.abs(nextHs - currentHs) < 0.002) break;
    headerEl.style.setProperty('--hs', String(nextHs));
  }
}

// schedule fit with debounce
let fitTimeout = null;
function scheduleFitHeader() {
  if (fitTimeout) clearTimeout(fitTimeout);
  fitTimeout = setTimeout(() => {
    fitHeaderScale();
  }, 60);
}

// react to resize/orientation
window.addEventListener('resize', scheduleFitHeader);
window.addEventListener('orientationchange', scheduleFitHeader);

// observe header / logo / nav changes
if (window.ResizeObserver) {
  const ro = new ResizeObserver(() => scheduleFitHeader());
  const headerEl = document.getElementById('header');
  if (headerEl) {
    ro.observe(headerEl);
    const logo = headerEl.querySelector('img.logo');
    const nav = headerEl.querySelector('nav');
    if (logo) ro.observe(logo);
    if (nav) ro.observe(nav);
    // observe anchors individually (in case text changes)
    nav && nav.querySelectorAll('a').forEach(a => ro.observe(a));
  }
}

// if fonts loaded later
if (document.fonts && document.fonts.ready) {
  document.fonts.ready.then(scheduleFitHeader).catch(()=>scheduleFitHeader());
}

// initial calls
document.addEventListener('DOMContentLoaded', scheduleFitHeader);
window.addEventListener('load', scheduleFitHeader);

/* Modal + other existing JS (unchanged) */
const modal = document.getElementById('modal');
const modalInner = document.getElementById('modalInner');
const modalCaption = document.getElementById('modalCaption');
const modalClose = document.getElementById('modalClose');

function openImage(url, caption=''){
  modalInner.innerHTML = '';
  const img = document.createElement('img');
  img.src = url;
  img.alt = caption || '';
  modalInner.appendChild(img);
  modalCaption.textContent = caption;
  showModal();
}
function openPDF(url, caption=''){
  modalInner.innerHTML = '';
  const iframe = document.createElement('iframe');
  iframe.className = 'pdf-frame';
  iframe.src = url;
  iframe.title = caption || 'CV';
  iframe.setAttribute('aria-label','PDF viewer');
  modalInner.appendChild(iframe);
  modalCaption.textContent = caption;
  showModal();
}
function showModal(){ modal.classList.add('visible'); modal.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; }
function closeModal(){ modal.classList.remove('visible'); modal.setAttribute('aria-hidden','true'); modalInner.innerHTML = ''; modalCaption.textContent = ''; document.body.style.overflow = ''; }

document.querySelectorAll('.bio-photos button').forEach(btn=>{
  btn.addEventListener('click', (e)=>{
    const full = btn.getAttribute('data-full');
    const caption = btn.getAttribute('data-caption') || '';
    if(full) openImage(full, caption);
  });
});
const viewPdfBtn = document.getElementById('viewPdfBtn');
viewPdfBtn && viewPdfBtn.addEventListener('click', (e)=>{
  e.preventDefault();
  openPDF('Sergei_Mkrtichian_CV.pdf', 'CV — Sergei Mkrtichian');
});
modalClose && modalClose.addEventListener('click', closeModal);
modal && modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

window.addEventListener('pageshow', function(event) {
  if (event.persisted) {
    heroImg.classList.remove('loaded');
    setTimeout(() => { heroImg.classList.add('loaded'); }, 50);
  }
});

document.addEventListener('DOMContentLoaded', () => {
  const preloadImages = ['s.JPG', 'logo.jpg'];
  preloadImages.forEach(src => { const img = new Image(); img.src = src; });
});

document.addEventListener('DOMContentLoaded', function() {
  function setVH() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }
  setVH();
  window.addEventListener('resize', setVH);
  window.addEventListener('orientationchange', setVH);

  let lastTouchEnd = 0;
  document.addEventListener('touchend', function(event) {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) { event.preventDefault(); }
    lastTouchEnd = now;
  }, false);

  document.querySelectorAll('button, a').forEach(el => {
    el.addEventListener('touchstart', function() {
      this.style.webkitTapHighlightColor = 'transparent';
    });
  });
});
  /* -------------------------
/* -------------------------
/* -------------------------
   Пропорциональное уменьшение (текст + иконки), с учётом реальных границ и точного CSS gap
   Вставьте этот блок в ваш <script>, например после fitHeaderScale()
   ------------------------- */
(function(){
  const MIN_SCALE = 0.6;     // минимальный коэффициент (подберите при необходимости)
  const EPS = 0.5;           // tolerance в px при сравнениях
  const headerEl = document.getElementById('header');
  if (!headerEl) return;

  // Обёртка content -> .link-inner, делает SVG/IMG responsive (1em)
  function ensureInner(link) {
    let inner = link.querySelector('.link-inner');
    if (inner) return inner;

    inner = document.createElement('span');
    inner.className = 'link-inner';
    // перенести всё содержимое в inner
    while (link.firstChild) inner.appendChild(link.firstChild);
    // базовые стили для корректных измерений
    inner.style.display = 'inline-block';
    inner.style.whiteSpace = 'nowrap';
    inner.style.lineHeight = '1';
    // Вставляем обратно
    link.appendChild(inner);

    // Для всех svg/img внутри — сделать масштабируемыми относительно font-size
    // и задать display/align чтобы не портить поточный layout.
    const svgs = inner.querySelectorAll('svg');
    svgs.forEach(sv => {
      // ставим CSS width/height в em — они станут зависеть от font-size inner
      sv.style.width = sv.style.width || '1em';
      sv.style.height = sv.style.height || '1em';
      sv.style.display = sv.style.display || 'inline-block';
      sv.style.verticalAlign = sv.style.verticalAlign || 'middle';
      // Если у SVG есть атрибуты width/height — они остаются, но CSS переопределит их
    });
    const imgs = inner.querySelectorAll('img');
    imgs.forEach(im => {
      im.style.width = im.style.width || '1em';
      im.style.height = im.style.height || '1em';
      im.style.display = im.style.display || 'inline-block';
      im.style.verticalAlign = im.style.verticalAlign || 'middle';
    });

    return inner;
  }

  // Парсер px значений из computedStyle
  function px(v){ return Number.parseFloat(v) || 0; }

  function adjustNavProportional() {
    const nav = headerEl.querySelector('nav');
    if (!nav) return;
    const links = Array.from(nav.querySelectorAll('a'));
    if (links.length === 0) return;

    // подготовка: wrap, сохранить orig font-size у inner, сбросить временные стили
    links.forEach(l => {
      const inner = ensureInner(l);
      if (!inner.dataset.origFontSize) {
        inner.dataset.origFontSize = getComputedStyle(inner).fontSize;
      }
      inner.style.fontSize = inner.dataset.origFontSize;
      inner.style.transform = '';
    });

    // доступная ширина внутри nav
    const available = nav.clientWidth;

    // точный gap из CSS (если browser поддерживает)
    const navStyle = getComputedStyle(nav);
    // some browsers return .gap, others return columnGap; prefer .gap then columnGap
    let gap = px(navStyle.gap || navStyle.columnGap || navStyle['column-gap']);
    // если gap не определён (старые браузеры) — fallback на исходное значение дизайна:
    if (!gap) gap = 18; // соответствует calc(18px * var(--hs)) в исходном CSS при hs=1

    // собираем paddings каждой ссылки и реальную ширину контента (inner)
    let totalPadding = 0;
    const contentWidths = links.map(l => {
      const cs = getComputedStyle(l);
      const pad = px(cs.paddingLeft) + px(cs.paddingRight);
      totalPadding += pad;
      const inner = ensureInner(l);
      // реальная ширина контента — bounding rect inner
      const rect = inner.getBoundingClientRect();
      const w = rect && rect.width ? rect.width : Math.max(0, l.getBoundingClientRect().width - pad);
      return w;
    });

    const totalContent = contentWidths.reduce((s, w) => s + w, 0);
    const totalGaps = gap * Math.max(0, links.length - 1);

    // Если влезает без изменений — восстановить оригинал и выйти
    if (totalContent + totalPadding + totalGaps <= available + EPS) {
      links.forEach(l => {
        const inner = ensureInner(l);
        inner.style.fontSize = inner.dataset.origFontSize;
      });
      return;
    }

    // Вычисляем единый коэффициент s, чтобы пропорционально уменьшить весь контент
    let s = (available - totalPadding - totalGaps) / totalContent;
    if (!isFinite(s) || s <= 0) s = MIN_SCALE;
    if (s > 1) s = 1;
    if (s < MIN_SCALE) s = MIN_SCALE;

    // Применяем s к font-size каждого inner (пропорционально исходному font-size)
    links.forEach(l => {
      const inner = ensureInner(l);
      const orig = px(inner.dataset.origFontSize);
      inner.style.fontSize = (orig * s) + 'px';
      inner.style.transformOrigin = 'left center';
    });
  }

  // scheduler (RAF) и события
  let raf = null;
  function scheduleAdjust() {
    if (raf) cancelAnimationFrame(raf);
    raf = requestAnimationFrame(() => {
      try { adjustNavProportional(); }
      catch(e){ console.error(e); }
      raf = null;
    });
  }

  window.addEventListener('resize', scheduleAdjust);
  window.addEventListener('orientationchange', scheduleAdjust);
  document.addEventListener('DOMContentLoaded', scheduleAdjust);
  window.addEventListener('load', scheduleAdjust);
  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(scheduleAdjust).catch(scheduleAdjust);
  }

  // экспорт для ручного вызова (например, вызвать в конце fitHeaderScale())
  window.adjustNavProportional = scheduleAdjust;
})();

</script>
</body>
</html>
